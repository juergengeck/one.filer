#!/usr/bin/make -f

# Debian rules file for one-leute-replicant
# This file defines how to build the Debian package

%:
	dh $@

override_dh_auto_configure:
	# Skip auto-configure - we handle this manually

override_dh_auto_build:
	# Copy source files to build directory
	mkdir -p debian/one-leute-replicant/opt/one-leute-replicant
	
	# Copy one.leute.replicant source
	cp -r one.leute.replicant/* debian/one-leute-replicant/opt/one-leute-replicant/
	
	# Copy one.core and one.models as dependencies
	mkdir -p debian/one-leute-replicant/opt/one-leute-replicant/node_modules/@refinio
	cp -r one.core debian/one-leute-replicant/opt/one-leute-replicant/node_modules/@refinio/
	cp -r one.models debian/one-leute-replicant/opt/one-leute-replicant/node_modules/@refinio/
	
	# Copy Windows integration components from one.filer
	mkdir -p debian/one-leute-replicant/opt/one-leute-replicant/windows-integration
	cp -r src/filer/Windows*.ts debian/one-leute-replicant/opt/one-leute-replicant/windows-integration/
	cp -r src/examples/windows-explorer-integration.ts debian/one-leute-replicant/opt/one-leute-replicant/windows-integration/
	
	# Copy configuration files
	cp -r debian/configs debian/one-leute-replicant/opt/one-leute-replicant/
	
	# Install systemd service file
	mkdir -p debian/one-leute-replicant/lib/systemd/system
	cp debian/systemd/one-leute-replicant.service debian/one-leute-replicant/lib/systemd/system/

override_dh_auto_install:
	# Skip auto-install - handled by postinst

override_dh_auto_test:
	# Skip tests during package build

override_dh_auto_clean:
	# Clean build artifacts
	rm -rf debian/one-leute-replicant/opt 